<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unread Letters ðŸ’Œ</title>

  <meta name="description" content="Read and send unread letters anonymously or with your name. A simple, elegant letters app.">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Unread Letters ðŸ’Œ">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
  <link rel="manifest" href="favicon_io/site.webmanifest">

  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      background: #fffaf5;
      font-family: 'Segoe UI', sans-serif;
      color: #333;
    }
    header {
      position: sticky;
      top: 0;
      background: #fff;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
      color: #e91e63;
    }
    main {
      padding: 1rem;
      max-width: 600px;
      margin: auto;
    }
    .letter {
      background: #fff;
      margin-bottom: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      overflow: hidden;
      transition: transform 0.2s;
      cursor: default;
    }
    .letter.collapsed .letter-content,
    .letter.collapsed .letter-footer {
      max-height: 60px;
      overflow: hidden;
      position: relative;
      cursor: pointer;
    }
    .letter.collapsed .letter-content::after {
      content: "â€¦";
      position: absolute;
      bottom: 0;
      right: 0;
      padding-left: 1rem;
      background: linear-gradient(to right, transparent, #fffaf5 80%);
      font-weight: bold;
      color: #e91e63;
    }
    .letter:hover {
      transform: translateY(-3px);
    }
    .letter-header {
      background: #e91e63;
      color: #fff;
      padding: 0.8rem 1rem;
      font-weight: bold;
      user-select: none;
    }
    .letter-content {
      padding: 1rem;
      line-height: 1.5;
      white-space: pre-wrap;
    }
    .letter-footer {
      text-align: right;
      font-size: 0.9rem;
      padding: 0 1rem 1rem;
      color: #555;
      user-select: none;
    }
    .fab {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: #e91e63;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      z-index: 30;
    }
    .fab:hover {
      transform: scale(1.1);
    }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 20;
    }
    .modal, .confirm-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 2rem 1rem 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      width: 85%;
      max-width: 320px;
      display: none;
      z-index: 25;
    }
    .modal input,
    .modal textarea {
      width: 100%;
      margin-bottom: 0.6rem;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
    }
    .modal textarea {
      resize: vertical;
      max-width: 100%;
    }
    .modal button,
    .confirm-modal button {
      width: 100%;
      padding: 0.8rem;
      border: none;
      background: #e91e63;
      color: #fff;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 0.5rem;
      transition: opacity 0.2s ease;
      font-family: inherit;
    }
    .modal button.sending {
      opacity: 0.7;
      cursor: not-allowed;
    }
    .confirm-modal {
      text-align: center;
    }
    .confirm-modal p {
      margin-bottom: 1rem;
      font-size: 1rem;
    }
    .confirm-actions {
      display: flex;
      gap: 0.5rem;
    }
    .confirm-actions button {
      flex: 1;
    }
    .skeleton {
      background: linear-gradient(90deg, #eee 25%, #f5f5f5 50%, #eee 75%);
      background-size: 400% 100%;
      animation: skeleton-loading 1.2s infinite;
      border-radius: 12px;
    }

    @keyframes skeleton-loading {
      0% { background-position: 100% 0; }
      100% { background-position: -100% 0; }
    }

    .skeleton-letter {
      height: 100px;
      margin-bottom: 1.5rem;
    }

    .input-error {
      border-color: #e91e63;
      box-shadow: 0 0 5px #e91e63;
    }

    .modal,
    .confirm-modal {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.9);
      transition: opacity 0.3s ease, transform 0.3s ease;
      pointer-events: none;
    }

    .modal.show,
    .confirm-modal.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: auto;
    }

    .page { display: none; }
    .page.active { display: block; }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.5rem;
      }
      main {
        padding: 0.8rem;
      }
      .letter {
        margin-bottom: 1rem;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }
      .letter-header {
        font-size: 1rem;
        padding: 0.6rem 0.8rem;
      }
      .letter-content {
        padding: 0.8rem;
        font-size: 0.95rem;
      }
      .letter-footer {
        padding: 0 0.8rem 0.8rem;
        font-size: 0.85rem;
      }
      .fab {
        bottom: 1.2rem;
        right: 1.2rem;
        width: 48px;
        height: 48px;
        font-size: 1.8rem;
      }
    }
    .close-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.7rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: #999;
      cursor: pointer;
      z-index: 10;
      transition: color 0.2s ease;
      user-select: none;
    }
    .close-btn:hover {
      color: #e91e63;
    }
    #loadMoreBtn {
      display: block;
      margin: 1rem auto 3rem;
      padding: 0.7rem 1.5rem;
      font-size: 1rem;
      background: #e91e63;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: background 0.3s;
      font-family: inherit;
    }
    #loadMoreBtn:hover:not(:disabled) {
      background: #c2185b;
    }
    #loadMoreBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>

<body class="bg-[#fffaf5] font-sans text-gray-800 min-h-screen flex flex-col">

  <header class="text-center p-4 bg-white shadow">
    <h1 class="text-xl font-bold text-pink-500">Unread Letters ðŸ’Œ</h1>
  </header>

  <!-- Page Content -->
  <main class="flex-grow p-4">
    <!-- Home Page -->
    <section id="homePage" class="page active">
      <h2 class="text-lg font-semibold">Welcome Home</h2>
      <p>This is your dashboard or intro page.</p>
    </section>

    <!-- Letters Page -->
    <section id="lettersContainer" class="page">
    <!-- Letters inserted here -->
    </section>

    <!-- Notifications Page -->
    <section id="notificationsPage" class="page">
      <h2 class="text-lg font-semibold mb-4">Notifications</h2>
      <div class="bg-white p-4 rounded shadow mb-2">ðŸ“¬ Coming soon!</div>
    </section>

    <!-- Account Page -->
    <section id="accountPage" class="page">
      <h2 class="text-lg font-semibold mb-4">Account Settings</h2>
      <p class="mb-2">Name: <strong>Anonymous</strong></p>
      <p class="mb-2">Coming soon!</p>
      <button class="mt-4 bg-gray-200 px-4 py-2 rounded hover:bg-gray-300" style="display:none">Edit Profile</button>
    </section>
  </main>

<!-- Bottom Navigation Bar -->
  <nav class="fixed bottom-0 left-0 right-0 z-50 bg-white shadow-md">
    <div class="flex justify-around items-center relative h-16">
      
      <!-- Home -->
      <button class="flex flex-col items-center text-pink-500" onclick="navigateTo('homePage')">
        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6" />
        </svg>
        <span class="text-xs">Home</span>
      </button>

      <!-- Letters -->
      <button class="flex flex-col items-center text-gray-400" onclick="navigateTo('lettersContainer')">
        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M21 10H7a2 2 0 00-2 2v4a2 2 0 002 2h14v-6a2 2 0 00-2-2zM3 8h18a2 2 0 012 2v6a2 2 0 01-2 2H3v-6a2 2 0 012-2z" />
        </svg>
        <span class="text-xs">Le</span>
      </button>

      <!-- Add (center button) -->
      <button class="absolute -top-6 bg-pink-500 text-white p-4 rounded-full shadow-lg hover:scale-105 transition-transform" onclick="openModal()" aria-label="Add new letter">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
          <path d="M12 4v16m8-8H4" />
          <button class="fab" onclick="openModal()" aria-label="Add new letter">+</button>
        </svg>
      </button>

      <!-- Notifications -->
      <button class="flex flex-col items-center text-gray-400">
        <div class="relative">
          <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" onclick="navigateTo('notificationsPage')">
            <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
          <span class="absolute top-0 right-0 bg-red-500 text-white text-[10px] px-1 rounded-full">2</span>
        </div>
        <span class="text-xs">Alerts</span>
      </button>

      <!-- Account -->
      <button class="flex flex-col items-center text-gray-400" onclick="navigateTo('accountPage')">
        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M5.121 17.804A7 7 0 0112 15a7 7 0 016.879 2.804M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <span class="text-xs">Account</span>
      </button>
    </div>
  </nav>

  <!-- JavaScript to handle navigation -->
  <script>
    function navigateTo(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');

      // Optional: highlight active button
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('text-pink-500'));
      const btn = [...document.querySelectorAll('.nav-btn')].find(b => b.getAttribute('onclick')?.includes(pageId));
      if (btn) btn.classList.add('text-pink-500');
    }
  </script>

  <button id="loadMoreBtn" style="display:none" aria-label="Load more letters">Load More</button>

  <div class="overlay" id="overlay" onclick="closeAllModals()"></div>

  <div class="modal" id="letterModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="close-btn" onclick="closeAllModals()" role="button" aria-label="Close modal">âœ•</div>
    <h2 id="modalTitle" style="display:none;">New Letter</h2>
    <input type="text" id="title" placeholder="Title" required aria-required="true" />
    <textarea id="message" rows="4" placeholder="Your message..." required aria-required="true"></textarea>
    <input type="text" id="sender" placeholder="From (e.g. Anonymous) / Optional" />
    <input type="text" id="nickname" name="nickname" style="display:none" autocomplete="off" tabindex="-1" />
    <button onclick="showConfirm()">Continue âžœ</button>
  </div>

  <div class="confirm-modal" id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <h2 id="confirmTitle" style="display:none;">Confirm Sending</h2>
    <p>The letter is <strong>not editable</strong>. Send it now or later?</p>
    <div class="confirm-actions">
      <button id="sendBtn" onclick="confirmSend()">Send ðŸ’Œ</button>
      <button onclick="closeConfirmModal()">Later</button>
    </div>
  </div>

<script>
  const API_BASE = '/api/letters';
  const PAGE_SIZE = 10;

  let offset = 0;
  let isLoading = false;
  let allLoaded = false;
  let lettersCache = [];
  let fetchTimeout;
  let isSending = false;
  let currentTrap = null;

  function debounceFetchLetters() {
    if (fetchTimeout) clearTimeout(fetchTimeout);
    fetchTimeout = setTimeout(() => {
      offset = 0;
      allLoaded = false;
      lettersCache = [];
      fetchLetters(true);
    }, 300);
  }


  function trapFocus(modal) {
    if (currentTrap) {
      currentTrap.cleanup();
    }

    const focusableElements = modal.querySelectorAll('input, button, textarea, [tabindex]:not([tabindex="-1"])');
    const firstEl = focusableElements[0];
    const lastEl = focusableElements[focusableElements.length - 1];

    function handleKeyDown(e) {
      if (e.key === 'Tab') {
        if (e.shiftKey) { // Shift + Tab
          if (document.activeElement === firstEl) {
            e.preventDefault();
            lastEl.focus();
          }
        } else { // Tab
          if (document.activeElement === lastEl) {
            e.preventDefault();
            firstEl.focus();
          }
        }
      }
    }

    modal.addEventListener('keydown', handleKeyDown);
    firstEl.focus();

    currentTrap = {
      cleanup() {
        modal.removeEventListener('keydown', handleKeyDown);
        currentTrap = null;
      }
    };
  }


  function openModal() {
    const modal = document.getElementById('letterModal');
    modal.style.display = 'block';
    modal.classList.add('show');
    document.getElementById('overlay').style.display = 'block';
    trapFocus(modal);
    document.body.style.overflow = 'hidden';
  }

  function closeConfirmModal() {
    document.getElementById('letterModal').style.display = 'block';
    document.getElementById('confirmModal').style.display = 'none';
    document.getElementById('overlay').style.display = 'block';
    resetSendingState();
  }

  function closeAllModals() {
    const modals = document.querySelectorAll('.modal, .confirm-modal');
    modals.forEach(m => {
      m.classList.remove('show');
      m.style.display = 'none';
    });
    document.getElementById('overlay').style.display = 'none';
    resetSendingState();
    document.body.style.overflow = ''; // restore scroll
    if (currentTrap) currentTrap.cleanup();
  }

  function showConfirm() {
    const titleInput = document.getElementById('title');
    const msgInput = document.getElementById('message');
    const title = titleInput.value.trim();
    const msg = msgInput.value.trim();

    titleInput.classList.remove('input-error');
    msgInput.classList.remove('input-error');

    if (!title || !msg) {
      if (!title) titleInput.classList.add('input-error');
      if (!msg) msgInput.classList.add('input-error');

      [titleInput, msgInput].forEach(input => {
        if (input.classList.contains('input-error')) {
          input.animate([
            { transform: 'translateX(0)' },
            { transform: 'translateX(-8px)' },
            { transform: 'translateX(8px)' },
            { transform: 'translateX(0)' }
          ], { duration: 300, easing: 'ease-in-out' });
        }
      });

      if (!title) titleInput.focus();
      else msgInput.focus();
      return;
    }

    document.getElementById('confirmModal').style.display = 'block';
    document.getElementById('confirmModal').classList.add('show');
    const letterModal = document.getElementById('letterModal');
    letterModal.classList.remove('show');
    letterModal.style.display = 'none';
    document.getElementById('overlay').style.display = 'block';
    trapFocus(document.getElementById('confirmModal'));
  }


  async function confirmSend() {
    if (isSending) return;
    isSending = true;

    const title = document.getElementById('title').value.trim();
    const msg = document.getElementById('message').value.trim();
    const sender = document.getElementById('sender').value.trim() || 'Anonymous';
    const nickname = document.getElementById('nickname').value.trim();

    const sendBtn = document.getElementById('sendBtn');
    sendBtn.textContent = 'Sending...';
    sendBtn.classList.add('sending');
    sendBtn.disabled = true;

    try {
      const res = await fetch(API_BASE, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, message: msg, sender, nickname })
      });

      const result = await res.json();
      if (result.success && result.id) {
        closeAllModals();

        const newLetter = {
          id: result.id,
          title,
          message: msg,
          sender,
          date: new Date().toISOString()
        };

        prependLetter(newLetter);
        lettersCache.unshift(newLetter);
        offset += 1;

        document.getElementById('title').value = '';
        document.getElementById('message').value = '';
        document.getElementById('sender').value = '';
        document.getElementById('nickname').value = ''; 
      } else {
        showToast('Error: ' + (result.error || 'unknown'));
        resetSendingState();
      }
    } catch (err) {
      showToast('Error occurred');
      resetSendingState();
    } finally {
      isSending = false;
    }
  }

  function resetSendingState() {
    const sendBtn = document.getElementById('sendBtn');
    sendBtn.textContent = 'Send ðŸ’Œ';
    sendBtn.disabled = false;
    sendBtn.classList.remove('sending');
  }


  function showSkeletons(count = 3) {
    const container = document.getElementById('lettersContainer');
    for (let i = 0; i < count; i++) {
      const div = document.createElement('div');
      div.className = 'letter skeleton skeleton-letter';
      container.appendChild(div);
    }
  }

  function removeSkeletons() {
    document.querySelectorAll('.skeleton').forEach(el => el.remove());
  }


  async function fetchLetters(reset = false) {
    if (isLoading || allLoaded) return;
    isLoading = true;

    if (reset) {
      offset = 0;
      lettersCache = [];
      allLoaded = false;
      document.getElementById('lettersContainer').innerHTML = '';
    }

    showSkeletons();

    try {
      const res = await fetch(`${API_BASE}?offset=${offset}&limit=${PAGE_SIZE}`);
      const data = await res.json();

      removeSkeletons();

      if (!Array.isArray(data) || data.length === 0) {
        allLoaded = true;
        document.getElementById('loadMoreBtn').style.display = 'none';

        const container = document.getElementById('lettersContainer');
        const existingMsg = document.getElementById('noMoreLettersMsg');
        if (existingMsg) existingMsg.remove();

        const msgDiv = document.createElement('div');
        msgDiv.id = 'noMoreLettersMsg';
        msgDiv.textContent = 'ðŸ“¬ No more letters to load.';
        msgDiv.style.textAlign = 'center';
        msgDiv.style.margin = '20px 0';
        msgDiv.style.fontStyle = 'italic';
        msgDiv.style.color = '#777';
        container.appendChild(msgDiv);

        isLoading = false;
        return;
      }

      data.sort((a, b) => new Date(b.date) - new Date(a.date));

      if (reset) {
        lettersCache = data;
        renderLetters(data, false);
      } else {
        lettersCache = lettersCache.concat(data);
        renderLetters(data, true);
      }

      offset += data.length;
      document.getElementById('loadMoreBtn').style.display = 'block';
    } catch (err) {
      console.error('Fetch error', err);
      removeSkeletons();
      showToast('Failed to load letters. Please try again.', 'error');
    }

    isLoading = false;
  }




  function shouldCollapse(dateStr) {
    const now = new Date();
    const letterDate = new Date(dateStr);
    if (isNaN(letterDate)) return false;
    const diffDays = (now - letterDate) / (1000 * 60 * 60 * 24);
    return diffDays > 30;
  }

  function toggleCollapse(event) {
    const letterDiv = event.currentTarget;
    letterDiv.classList.toggle('collapsed');
  }

  function formatRelativeTime(dateStr) {
    const now = new Date();
    const then = new Date(dateStr);
    if (isNaN(then)) return '';
    const diffInSeconds = Math.floor((now - then) / 1000);
    const minutes = Math.floor(diffInSeconds / 60);
    const hours = Math.floor(diffInSeconds / 3600);
    const days = Math.floor(diffInSeconds / 86400);
    const months = Math.floor(diffInSeconds / (30 * 86400));
    const years = Math.floor(diffInSeconds / (365 * 86400));

    if (diffInSeconds < 5) return `just now`;
    if (diffInSeconds < 60) return `${diffInSeconds} second${diffInSeconds !== 1 ? 's' : ''} ago`;
    if (minutes < 60) return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
    if (hours < 24) return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
    if (days < 2) return `yesterday`;
    if (days < 30) return `${days} day${days !== 1 ? 's' : ''} ago`;
    if (months < 12) return `${months} month${months !== 1 ? 's' : ''} ago`;
    return `${years} year${years !== 1 ? 's' : ''} ago`;
  }

  function escapeHTML(str) {
    return str.replace(/[&<>"']/g, tag => (
      {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      }[tag]
    ));
  }

  function escapeHTMLWithBreaks(s) {
    return escapeHTML(s).replace(/\n/g, '<br>');
  }

  function renderLetters(letters, append = false) {
    const container = document.getElementById('lettersContainer');
    const fragment = document.createDocumentFragment();

    letters.forEach(l => {
      const div = createLetterElement(l);
      fragment.appendChild(div);
    });

    if (append) {
      container.appendChild(fragment);
    } else {
      container.innerHTML = '';
      container.appendChild(fragment);
    }
  }

  function prependLetter(letter) {
    const container = document.getElementById('lettersContainer');
    const div = createLetterElement(letter);
    container.insertBefore(div, container.firstChild);
  }

  function createLetterElement(letter) {
    const div = document.createElement('div');
    div.className = 'letter';

    if (shouldCollapse(letter.date)) {
      div.classList.add('collapsed');
      div.setAttribute('title', 'Click to expand/collapse');
      div.style.cursor = 'pointer';
      div.addEventListener('click', toggleCollapse);
    }

    const safeTitle = escapeHTML(letter.title);
    const safeMessage = escapeHTMLWithBreaks(letter.message);
    const safeSender = escapeHTML(letter.sender);
    const relativeTime = formatRelativeTime(letter.date);

    div.innerHTML = `
      <div class="letter-header">${safeTitle}</div>
      <div class="letter-content"><p>${safeMessage}</p></div>
      <div class="letter-footer">
        â€“ ${safeSender}<br>
        <small>${relativeTime}</small>
      </div>
    `;

    return div;
  }

  function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.textContent = message;
    toast.style.position = 'fixed';
    toast.style.bottom = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.padding = '12px 24px';
    toast.style.borderRadius = '4px';
    toast.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
    toast.style.fontFamily = 'Arial, sans-serif';
    toast.style.zIndex = '9999';
    toast.style.opacity = '0';
    toast.style.transition = 'opacity 0.3s ease-in-out';

    if (type === 'error') {
      toast.style.backgroundColor = '#f44336';
      toast.style.color = '#fff';
    } else if (type === 'success') {
      toast.style.backgroundColor = '#4caf50';
      toast.style.color = '#fff';
    } else {
      toast.style.backgroundColor = '#333';
      toast.style.color = '#fff';
    }

    document.body.appendChild(toast);

    requestAnimationFrame(() => {
      toast.style.opacity = '1';
    });

    setTimeout(() => {
      toast.style.opacity = '0';
      toast.addEventListener('transitionend', () => toast.remove());
    }, 4000);
  }



  document.getElementById('loadMoreBtn').addEventListener('click', fetchLetters);



  window.addEventListener('scroll', () => {
    const nearBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 200;
    if (nearBottom && !isLoading && !allLoaded) {
      fetchLetters(false);  
    }
  });

  fetchLetters(); // Initial load
</script>

</body>
</html>
